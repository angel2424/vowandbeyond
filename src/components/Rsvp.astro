<section id="rsvp" class="bg-brand-50 px-6 py-28">
  <div class="mx-auto mb-20 flex max-w-6xl flex-col gap-2 text-center">
    <span class="text-primary text-xl font-normal tracking-widest uppercase"
      >¡Queremos compartir este momento tan esperado contigo!</span
    >
    <h4 class="text-brand-950 text-4xl font-medium">Ayúdanos confirmando tu asistencia</h4>
  </div>
  <form data-rsvp-form class="mx-auto max-w-6xl space-y-10" method="POST" action="/api/rsvp">
    <div class="flex flex-col gap-8 lg:flex-row">
      <div class="group relative z-0 mb-5 w-full">
        <input
          type="text"
          name="full_name"
          id="full_name"
          class="focus:border-brand peer focus:border-b-primary block w-full appearance-none border-0 border-b-2 border-b-gray-400 bg-transparent px-0 py-2.5 text-sm focus:ring-0 focus:outline-none"
          placeholder=" "
          autocomplete="name"
          required
        />
        <label
          for="full_name"
          class="peer-focus:text-brand-950 absolute top-1 -z-10 origin-left -translate-y-6 scale-75 transform text-base text-gray-600 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-85 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4"
          >Nombre completo</label
        >
      </div>
      <div class="group relative z-0 mb-5 w-full">
        <input
          type="number"
          name="guests_count"
          id="guests_count"
          min="0"
          max="10"
          class="focus:border-brand peer focus:border-b-primary block w-full appearance-none border-0 border-b-2 border-b-gray-400 bg-transparent px-0 py-2.5 text-sm focus:ring-0 focus:outline-none"
          placeholder=" "
          required
        />
        <label
          for="guests_count"
          class="peer-focus:text-brand-950 absolute top-1 -z-10 origin-left -translate-y-6 scale-75 transform text-base text-gray-600 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-85 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4"
          ># de invitados</label
        >
      </div>
    </div>

    <div class="flex flex-col gap-8 lg:flex-row">
      <div class="group relative z-0 mb-5 w-full">
        <input
          type="tel"
          name="phone"
          id="phone"
          class="focus:border-brand peer focus:border-b-primary block w-full appearance-none border-0 border-b-2 border-b-gray-400 bg-transparent px-0 py-2.5 text-sm focus:ring-0 focus:outline-none"
          placeholder=" "
          autocomplete="tel"
        />
        <label
          for="phone"
          class="peer-focus:text-brand-950 absolute top-1 -z-10 origin-left -translate-y-6 scale-75 transform text-base text-gray-600 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-85 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4"
          >Teléfono (opcional)</label
        >
      </div>
      <div class="group relative z-0 mb-5 w-full">
        <textarea
          name="notes"
          id="notes"
          rows="1"
          class="focus:border-brand peer focus:border-b-primary block w-full appearance-none border-0 border-b-2 border-b-gray-400 bg-transparent px-0 py-2.5 text-sm focus:ring-0 focus:outline-none"
          placeholder=" "></textarea>
        <label
          for="notes"
          class="peer-focus:text-brand-950 absolute top-1 -z-10 origin-left -translate-y-6 scale-75 transform text-base text-gray-600 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-85 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4"
          >Notas</label
        >
      </div>
    </div>

    <div class="mt-8 flex flex-col items-center justify-center">
      <h6 class="mb-5 text-xl font-medium text-gray-600">Confirma tu asistencia</h6>
      <label class="inline-flex cursor-pointer items-center gap-3">
        <input type="checkbox" name="attending" value="true" class="peer sr-only" />
        <span class="text-brand-600 text-base font-medium select-none peer-checked:text-gray-600"
          >No asistiré</span
        >
        <div
          class="peer-focus:ring-brand-600 peer peer-checked:after:border-buffer peer-checked:bg-primary bg-brand-200 relative h-5 w-9 rounded-full peer-focus:ring-1 peer-focus:outline-none after:absolute after:start-0.5 after:top-0.5 after:h-4 after:w-4 after:rounded-full after:bg-white after:transition-all after:content-[''] peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full"
        >
        </div>
        <span class="peer-checked:text-brand-600 text-base font-medium text-gray-600 select-none"
          >Asistiré</span
        >
      </label>
      <p id="rsvp-status" class="mt-4 text-sm text-gray-600" aria-live="polite"></p>
      <button
        type="submit"
        class={`mt-10 border-2 uppercase hover:scale-[1.01] transition-[scale,color,border] ease-linear duration-150 cursor-pointer px-10 py-2 btn text-brand-500 border-brand-400 before:bg-brand-50! hover:text-brand-50 disabled:cursor-not-allowed disabled:opacity-70`}
      >
        <span class="submit-label">Envíar Confirmación</span>
        <span class="submit-loading hidden!">Enviando...</span>
      </button>
    </div>
  </form>
</section>

<script>
  const form = document.querySelector('[data-rsvp-form]') as HTMLFormElement | null
  const status = document.getElementById('rsvp-status') as HTMLElement

  form?.addEventListener('submit', async (e) => {
    e.preventDefault()

    const formData = new FormData(form)

    const res = await fetch(form.action, {
      method: 'POST',
      body: formData,
    })

    const data = await res.json().catch(() => ({}))

    if (!res.ok) {
      status.textContent = data.error || 'No pudimos guardar tu confirmación.'
      return
    }

    status.textContent = '¡Gracias! Registramos tu respuesta.'
    form.reset()
  })
</script>
